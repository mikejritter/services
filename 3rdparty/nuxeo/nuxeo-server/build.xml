<project name="nuxeo-server" default="deploy" basedir=".">
    <description>Collectionspace Services - Nuxeo Server</description>
    <property environment="env" />

    <target name="deploy" depends="deploy-bundles,deploy-libs" />

    <target name="check-env">
        <fail unless="env.CSPACE_JEESERVER_HOME" message="CSPACE_JEESERVER_HOME is not set" />
    </target>

    <target name="deploy-bundles" depends="check-env">
        <property name="nuxeo.bundles" value="${env.CSPACE_JEESERVER_HOME}/nuxeo-server/bundles" />

        <!-- use includeGroupIds in order to only deploy nuxeo dependencies -->
        <exec executable="mvn" failonerror="true">
            <arg value="dependency:copy-dependencies" />
            <arg value="-DoutputDirectory=${nuxeo.bundles}" />
            <arg value="-DincludeScope=runtime" />
            <arg value="-DincludeGroupIds=org.nuxeo" />
        </exec>
    </target>

    <target name="deploy-libs" depends="check-env">
        <property name="nuxeo.lib" value="${env.CSPACE_JEESERVER_HOME}/nuxeo-server/lib" />

        <!-- use excludeGroupIds in order ignore nuxeo, logging, and other misc dependencies -->
        <exec executable="mvn" failonerror="true">
            <arg value="dependency:copy-dependencies" />
            <arg value="-DoutputDirectory=${nuxeo.lib}" />
            <arg value="-DincludeScope=runtime" />
            <arg value="-DexcludeGroupIds=org.nuxeo,junit,org.sl4j,log4j,org.apache.logging.log4j" />
        </exec>
    </target>
</project>
